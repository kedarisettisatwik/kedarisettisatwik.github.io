<html>
<head>
    <title>sit</title>
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <!-- google fonts -->
    <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
        }
        body{
            width:100vw;
            min-height:100vh;
            font-family: 'Roboto', sans-serif;
        }
        #intro{
            position: absolute;
            top:0;
            left:0;
            width:100vw;
            height:100vh;
            display:flex;
            justify-content: center;
            align-items:center;
            z-index:10;
            background-color:aliceblue;
        }
        #intro div{
            position: relative;
            min-width:50%;
            height:auto;
            padding:4em;
            background-color:rgb(0, 0, 102);
            color:white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #intro div label,#intro div p{
            font-size:2em;
            letter-spacing:5px;
            font-weight:bold;
        }
        #intro div p{
            letter-spacing:8px;
            font-weight:bold;
            color:antiquewhite;
        }
        #intro div h1{
            letter-spacing:15px;
            margin:0.5em 0;
           font-size:4em;  
        }
        #signup{
            position: absolute;
            min-height:100vh;
            width:100vw;
            display:none;
            justify-content: center;
            align-items: center;
            background-color:white;
        }
        #signup div{
            transition:1s;
            border:2px solid black;
            position: relative;
            min-width:60%;
            height:auto;
            padding:4em;
            display: flex;
            align-items: center;
            flex-direction: column;
        }
        #signup div label{
            position: relative;
            margin-bottom:3em;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #signup div label input{
            letter-spacing:3px;
            font-weight:bold;
            padding-bottom:0.1em;
            font-size:2.2em;
            margin:1em 0;
            outline:0;
            border:0;
            border-bottom:0.1em solid black;
        }
        #signup div label button{
            text-transform:uppercase;
            letter-spacing:4px;
            font-weight:bold;
            font-size:2.2em;
            margin:0.5em 0 0 0;
            padding:0.5em;
            outline:0;
            border:2px solid black;
        }
        #signup div p{
            font-size:2.2em;
        }
        #signup div span{
            font-weight:bold;
            letter-spacing:3px;
            width:100%;
            text-align: center;
            font-size:2.2em;
            padding:0.5em;
            margin-bottom:0.5em;
            display:none;
        }
        #signup div .b{
            font-weight:bold;
            letter-spacing:3px;
            padding:0.5em;
            outline:0;
            position: relative;
            width:100%;
            font-size:2.2em;
            background-color:rgb(0, 0, 102);
            color:white;
        }
        #signup div h1{
            position: relative;
            letter-spacing:10px;
            margin:0.5em 0;
           font-size:4em;
            text-transform:uppercase;
        }
        #signin{
            position: absolute;
            min-height:100vh;
            width:100vw;
            display:flex;
            justify-content: center;
            align-items: center;
            background-color:white;
        }
        #signin div{
            transition:1s;
            border:2px solid black;
            position: relative;
            min-width:60%;
            height:auto;
            padding:4em;
            display: flex;
            align-items: center;
            flex-direction: column;
        }
        #signin div label{
            position: relative;
            margin-bottom:3em;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #signin div label input{
            letter-spacing:3px;
            font-weight:bold;
            padding-bottom:0.1em;
            font-size:2.2em;
            margin:1em 0;
            outline:0;
            border:0;
            border-bottom:0.1em solid black;
        }
        #signin div label button{
            text-transform:uppercase;
            letter-spacing:4px;
            font-weight:bold;
            font-size:2.2em;
            margin:0.5em 0 0 0;
            padding:0.5em;
            outline:0;
            border:2px solid black;
        }
        #signin div p{
            font-size:2.2em;
        }
        #signin div span{
            font-weight:bold;
            letter-spacing:3px;
            width:100%;
            text-align: center;
            font-size:2.2em;
            padding:0.5em;
            margin-bottom:0.5em;
            display:none;
        }
        #signin div .b{
            font-weight:bold;
            letter-spacing:3px;
            padding:0.5em;
            outline:0;
            position: relative;
            width:100%;
            font-size:2.2em;
            background-color:rgb(0, 0, 102);
            color:white;
        }
        #signin div h1{
            position: relative;
            letter-spacing:10px;
            margin:0.5em 0;
           font-size:4em;
            text-transform:uppercase;
        }
        #users{
            position: absolute;
            width:100vw;
            min-height:100vh;
            display:none;
            align-items: center;
            flex-direction: column;
            background-color:white;
        }
        #users .box{
            background-color:black;
            position:relative;
            width:70%;
            border:2px solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin-top:20vh;
            padding:3em;
        }
        #users .box input{
            letter-spacing:3px;
            width:90%;
            font-size:2.2em;
            padding:1em;
            margin:1em;
            outline:none;
            border-radius:50px;
        }
        #users label{
            border:0.1em solid black;
            width:70%;
            padding:1em 1em;
            font-size:2.2em;
            font-weight:bold;
            letter-spacing:3px;
            margin:0.2em 0;
        } 
        #names{
            position: relative;
            width:100%;
            display:flex;
            align-items: center;
            flex-direction: column;
        }
        #users label p {
            float: right;
            opacity:0.5;
            margin-right:10px;
        }
        #chatplace{
            position: absolute;
            width:100vw;
            min-height:100vh;
            display:none;
            align-items: center;
            flex-direction: column;
            background-color:white;  
        }
        #chatplace span{
            margin:1em 0;
            font-size:2.5em;
            position:absolute;
            width:90%;
            min-height:10vh;
            padding-left:1em;
            border:0.1em solid black;
            display: flex;
            align-items: center;
            letter-spacing:3px;
        }
        #chatplace span button{
          position: absolute;
          right:1em;
          background-color: black;
          color:white;
           font-weight:bold;
           padding:0.5em 1em;
            font-size:1em;
        }
        #chatplace #area{
            top:14vh;
            position:absolute;
            width:90%;
            height:70vh;
            border:0.1em solid black;
            letter-spacing:3px; 
            display: flex;
            align-items: center;
            flex-direction: column;
            overflow-y: auto;
        }
        #sendmsg{
            overflow:hidden;
            top:84vh;
            position:absolute;
            width:90%;
            min-height:10vh;
            padding-left:1em;
            border:0.1em solid black;
            display: flex;
            align-items: center;
            letter-spacing:3px;  
        }
        #text{
            font-size:3em;
            width:80%;
            padding:1em;
            border:0;
            outline:0;
            height:9vh;
        }
        #sendmsg input[type = "submit"]{
           font-size:2em;
            width:20%;
            padding:1em;
            border:0;
            outline:0;
            background-color:black;
            color:white;  
            white-space: pre-wrap;
            height:9vh;
        }
        .bb{
            position: relative;
            width:100%;
            margin:0.5em 0;
            white-space: pre-wrap;
        }
        .memsg{
            word-wrap: break-word;
            max-width:70%;
            padding:1em 2em;
            background-color:antiquewhite;
            float:right;
            font-size:2.2em;
            font-weight:bold;
        }
        .othermsg{
            word-wrap: break-word;
            max-width:70%;
            padding:1em 2em;
            background-color:aliceblue;
            float:left;
            font-size:2.2em;
            font-weight:bold;
        }
    </style>
</head>
    <body>
       <section id="intro">
        <div>
           <label>Welcome to </label>
           <h1>SIM</h1>
           <p>Send Instant Messages</p>
        </div>
       </section> 
       <section id="signup">
           <div>
               <h1>sign up </h1>
               <span id="error">error</span>
            <label>
                <input type="text" placeholder="user-id" id="user_id">
                <input type="text" placeholder="password" id="pass">
                <input type="password" placeholder="retype password" id="repass">
                <button onclick="adduser()">+ create account</button>
            </label>
          <button class="b" onclick="changepage(1)">Go to sign in page</button>
           </div>
       </section>
       <section id="signin">
           <div>
               <h1>sign in </h1>
               <span id="error1">error</span>
            <label>
                <input type="text" placeholder="user-id" id="user_id1">
                <input type="text" placeholder="password" id="pass1">
                <button onclick="checkuser()">sign in </button>
            </label>
          <button class="b" onclick="changepage(2)">Go to sign up page</button>
           </div>
       </section>
       <section id="users">
        <div class="box">
           <input type="text" placeholder="search other users" id="search_field">
        </div>
          <div id="names">
              
           </div>  
        </section> 
        <section id="chatplace">
        <span>
           <h1 id="touser"></h1>
            <button onclick="changepage(3)">
            back
            </button>
        </span>
        <div id="area">
            
        </div>
        <form id="sendmsg">
            <textarea type="text" required placeholder="write message" id="text"></textarea>
            <input type="submit" value="send">
        </form>
        </section>

<script src="https://www.gstatic.com/firebasejs/8.3.2/firebase.js"></script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyAAf-t316qGcYZgpJZ8QhQ_9CVPabDzX48",
    authDomain: "what-s-app-ad417.firebaseapp.com",
    databaseURL: "https://what-s-app-ad417-default-rtdb.firebaseio.com",
    projectId: "what-s-app-ad417",
    storageBucket: "what-s-app-ad417.appspot.com",
    messagingSenderId: "692077766689",
    appId: "1:692077766689:web:afff3786389b8379829b60",
    measurementId: "G-D8YRKX04X8"
  };
  firebase.initializeApp(firebaseConfig);
</script>
<script>
        var admin;
        var toto;
    
       setTimeout(function(){
var i = document.getElementById("intro");
         document.body.removeChild(i); 
        },1500);
        
        
        var arr = [];  
        
        function adduser(){
            var id = document.getElementById("user_id").value;
            var pass = document.getElementById("pass").value;
            var repass = document.getElementById("repass").value;
            var display = document.getElementById("error");
            if (id != "" && pass != "" && repass != ""){
                if (pass == repass){ 
        if (arr.includes(id)){
                   display.style.display = "block";
               display.style.backgroundColor = "lightpink";
               display.innerHTML = "sorry,this user id already exist try different one..";
               }else{
                   display.style.display = "block";
               display.style.backgroundColor = "lightgreen";
               display.innerHTML = "successfully registered";   
    firebase.database().ref("sim/users").push({
                user_id : id,
                password : pass
            });
                load();
               }
            } else{
               display.style.display = "block";
               display.style.backgroundColor = "lightpink";
               display.innerHTML = "password confirmation failed";
                }
            }else{
               display.style.display = "block";
               display.style.backgroundColor = "lightpink";
               display.innerHTML = "All fields required";
            }
        }
        
        function changepage(a){
            var aa = document.getElementById("signin");
            var bb = document.getElementById("signup");
            var cc = document.getElementById("users");
            var dd = document.getElementById("chatplace");
            if (a == 1){
                aa.style.display = "flex";
                bb.style.display = "none";
                cc.style.display = "none";
                dd.style.display = "none";
            }
            if (a == 2){
                bb.style.display = "flex";
                aa.style.display = "none"; 
                cc.style.display = "none";
                dd.style.display = "none";
            }
            if (a == 3){
               bb.style.display = "none";
                aa.style.display = "none"; 
                cc.style.display = "flex"; 
                dd.style.display = "none";
                draw();
            }
            if (a == 4){
                bb.style.display = "none";
                aa.style.display = "none"; 
                cc.style.display = "none"; 
                dd.style.display = "flex"; 
            }
        }
    
        
        
         var arraynames = arr;
    
        function draw(a){
            var d = document.getElementById("names");
            d.innerHTML = '';
           for (var i = 0;i<arraynames.length;i++){
    if (arraynames[i] != admin){
        d.innerHTML += "<label onclick = place('"+arraynames[i]+"')>"+arraynames[i]+"</label>";
    }    
           } 
        }
        
        var sec = document.getElementById("users");
        var search = document.getElementById("search_field");
        search.addEventListener("keyup", (e) => {
           var value = search.value;
           if (value == ""){
               draw(arraynames);
           }else{
               if (value != " "){
            var d = document.getElementById("names");
                   d.innerHTML = '';
                for (var i = 0;i<arraynames.length;i++){ 
                    var xyz = arraynames[i].toLowerCase() ;
                    var value1 = value.toLowerCase();
                    if (xyz.indexOf(value1) > -1){
        if (arraynames[i] != admin){
            d.innerHTML += "<label onclick = place('"+arraynames[i]+"')>"+arraynames[i]+"</label>";
            }
                    } 
                 }
              }
           }
        });
        
        function checkuser(){
            var display = document.getElementById("error1");
        var usercheck = document.getElementById("user_id1").value;
    var pp = document.getElementById("pass1").value;
         if (usercheck != "" & pp != ""){
firebase.database().ref('sim/users').once('value',function(snapshot){
        snapshot.forEach(function(ChildSnapShot){
            let u = ChildSnapShot.val().user_id;
            let p = ChildSnapShot.val().password;
            if (u == usercheck && p == pp){
                admin = u;
               changepage(3); 
            }else{
              display.style.display = "block";
               display.style.backgroundColor = "lightpink";
               display.innerHTML = "wrong credits";  
            }
        })
    });
         }else{
             display.style.display = "block";
               display.style.backgroundColor = "lightpink";
               display.innerHTML = "All fields required";
         }
        }
            
        function place(abc){
            changepage(4);
            var p = document.getElementById("touser");
            p.innerHTML = abc;
            toto = abc;
 var section = document.getElementById("area");       document.getElementById("area").innerHTML = "";    
            checktext(admin,toto);
        }
    
       function checktext(f,t){
var section = document.getElementById("area");       document.getElementById("area").innerHTML = "";
firebase.database().ref("sim/Texts").on("child_added",(s) => {
    if (s.val().from == f && s.val().to == t){
    section.innerHTML += "<div class='bb'>"+"<label class='memsg'>"+s.val().msg+"</label>";
        }
    if (s.val().to == f && s.val().from == t){
    section.innerHTML += "<div class='bb'>"+"<label class='othermsg'>"+s.val().msg+"</label>";
        }
        });
       }
    
        var sendform = document.getElementById("sendmsg");
        sendform.addEventListener("submit",(e) => {
              e.preventDefault();
var intext = document.getElementById("text").value;
    firebase.database().ref("sim/Texts").push({
                from : admin,
                to  :toto,
                msg:intext
            });
    document.getElementById("text").value = "";
        });
        
        function load(){
            setTimeout(function(){
                location.reload();
            },2000);
        }
    
firebase.database().ref('sim/users').once('value',function(snapshot){
           snapshot.forEach(function(ChildSnapshot){
               let username = ChildSnapshot.val().user_id;
               arr.push(username);
           }) 
        });
    </script>   
    </body>
</html>

<!--

"<div class=''bb'>
    <label class='memsg'>"++"</label>"
</div>
<div class="bb">
     <label class="othermsg">hi ra</label>
</div>

var section = document.getElementById("area");
var intext = document.getElementById("text").value;
section.innerHTML += "<div class='bb'>"+"<label class='memsg'>"+intext+"</label>";
document.getElementById("text").value = "";

-->