<html>
<head>
   <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000" />
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" rel="stylesheet">
    <script src="images/jquery-3.6.0.min.js"></script>
    <!-- google fonts -->
    <title>save the square</title>
    <style>
        
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family: 'Poppins', sans-serif;
            user-select: none;
        }
        html{
            --x : 0;
            --y : 0;
            --sx : 0;
            --sy : 0;
            --sr : 0;
        }
        body {
            width: 100vw;
            height:100vh;
            overflow: hidden;
            display:flex;
            justify-content: center;
            align-items:center;
            flex-direction: column;
            background-color: white;
        }
        .flex{
            display: flex;
            justify-content:center;
            align-items: center;
            flex-direction: column;
        }
        p{
            font-size:14px;
            opacity:0.6;
        }
        .game{
            width:600px;
            height:350px;
            box-shadow:0 0 15px rgb(0,0,0,0.1);
            overflow: hidden;
            position:relative;
            background-color: ghostwhite;
        }
        .game.mobile{
            width:100vh;
            height:100vw;
            position: absolute;
            transform:rotateZ(90deg);
            box-shadow:0 0 15px rgb(0,0,0,0);
        }
        .camera{
            position: absolute;
            left:calc(calc(var(--x) - 50) * 1px);
            bottom:0;
            width:100%;
            height:100%;
            transform:translate(calc(var(--x) * 0px),calc(var(--y) * 1px));
            transition:0.5s,left 1.5s ease;
            transition-delay:0s,0.7s;
        }
        .bg{
            position: absolute;
            width:100%;
            height:100%;
            background-image:linear-gradient(to bottom,rgb(0,0,0,0.45),rgb(255,255,255,0.3));
        }
        .ground,.wall{
            position: absolute;
            background-color: black;
            left:0;
            bottom:0;
        }
        .ground{
            width:200%;
            height:60px;
            left:calc(calc(var(--x) - 50) * -1px);
            transition:left 1.5s ease;
            transition-delay:0.7s;
        }
        .wall{
            height:calc(100% + 70px);
            width:220px;
        }
        .wall,.ground,.block{
            box-shadow:0 0 2px rgb(0,0,0);
        }
        .blocks{
            position: absolute;
            left:220px;
            bottom:60px;
            height:calc(100% - 60px);
            min-width:calc(100% - 220px);
        }
        .levels{
            position: absolute;
            height:100%;
            min-width:100%;
            top:0;
            left:0;
        }
        .block,.player{
            position: absolute;
            background-color: black;
            bottom:0;
        }
        .square{
            position: absolute;
            width:25px;
            height:25px;
            bottom:60px;
            left:30px;
        }
        .pieces{
            position:absolute;
            width:100%;
            height:100%;
            transition:0.1s;
            opacity:1;
        }
        .player{
            width:100%;
            position: absolute;
            height:100%;
            background-color: black;
            box-shadow:0 0 5px rgb(0,0,0,0.3);
            bottom:0;
            left:0;
        }
        .player .circle{
            position: absolute;
            top:5px;
            right:5px;
            width:7px;
            height:7px;
            border-radius:50%;
            background-image:linear-gradient(220deg,rgb(255,255,255,1),rgb(255,255,255,0.8));
            transition:right 0.5s ease-in,opacity 0s;
            transition-delay:0.1s,0s;
        }
        .piece{
            position: absolute;
            bottom:calc(calc(var(--sy) + 1) * 1px);
            left:calc(calc(var(--sx) + 12.5) * 1px);
            background-color: black;
            width:calc(var(--wh) * 1px);
            height:calc(var(--wh) * 1px);
            transform:translateX(-50%) rotateZ(calc(1deg * var(--sr)));
            transition:0.5s;
            transition-delay:calc(1s * var(--s));
        }
        .buttons{
            position: absolute;
            bottom:20px;
            height:55px;
            width:100%;
            left:0;
        }
        .buttons .button{
            position: absolute;
            width:55px;
            height:55px;
            top:50%;
            transform:translateY(-50%);
            cursor:pointer;
            background-color:#8c8c8c;
        }
        .buttons img{
            width:25px;
            filter: invert(1);
        }
        .board{
            position: absolute;
            top:10px;
            right:20px;
            flex-direction: row;
        }
        .board .distance{
            margin-right:20px;
        }
        .board h2{
            font-size:17px;
            letter-spacing:1px;
        }
        .board h3{
            font-size:17px;
            text-align: right;
            color:white;
            text-shadow:0 0 3px rgb(0,0,0);
            letter-spacing:3px;
        }
        .board .pp{
            flex-direction: row;
            cursor:pointer;
            width:40px;
            height:40px;
            background-color:rgb(0,0,0,0.2);
        }
        .board .pp img{
            width:15px;
            filter:invert(1);
        }
        .board .pp img:nth-child(1){
            display: block;
        }
        .board .pp img:nth-child(2){
            display: none;
        }
        .board .pp.active img:nth-child(1){
            display: none;
        }
        .board .pp.active img:nth-child(2){
            display: block;
        }
        
    </style>
    </head>
<body>
  
  <section class="game">
    <div class="bg"></div>
    <section class="camera">
        <div class="ground"></div>
        <div class="wall"></div>
        <div class="blocks">
            <div class="levels">
                <div class="block" style="left:0px;height:60px;width:121px;"></div>
            </div>
            <div class="square">
                <div class="pieces">
                    <div class="piece" style="--wh:10;--s:0.1;"></div>
                    <div class="piece" style="--wh:9;--s:0.14"></div>
                    <div class="piece" style="--wh:8;--s:.18"></div>
                    <div class="piece" style="--wh:7;--s:0.22"></div>
                    <div class="piece" style="--wh:6;--s:0.26"></div>
                    <div class="piece" style="--wh:5;--s:0.30"></div>
                    <div class="piece" style="--wh:4;--s:0.34"></div>
                    <div class="piece" style="--wh:3;--s:0.38"></div>
                </div>
                <div class="player"><div class="circle"></div></div>
            </div>
        </div>
    </section>
    <div class="buttons">
            <div class="button flex left" style="left:30px;">
                <img src="images/arrow-left-solid.svg">
            </div>
            <div class="button flex right" style="left:90px;">
                <img src="images/arrow-right-solid.svg">
            </div>
            <div class="button flex up" style="right:30px;">
                <img src="images/arrow-up-solid.svg">
            </div>
    </div>
    <div class="board flex">
            <div class="distance">
                <h2>Distance</h2>
                <h3><span class="meters">0</span><label> m</label></h3>
            </div>
            <div class="pp flex" onclick="control()">
                <img src="images/pause-solid.svg">
                <img src="images/play-solid.svg">
            </div>
        </div>
  </section>
  
  <p class='notice' style="margin-top:50px;">Use arrows to move & jump</p>
<!--  <p class='notice'>Use ctrl + arrows to jump front and jump back</p>-->
  <p class='notice' style="margin-top:10px;">Use space bar to pause & play </p>
    
  
  <script>
      
      var distance = 0;
      var d1 = 0;
      
      var audio_jump = new Audio("images/jump.mp3");
      audio_jump.volume = 0.2;
      
      let para = new URLSearchParams(window.location.search);
      if (parseInt(para.get('mobile')) == 1){
          document.body.style.backgroundColor = 'black';
          var game = document.querySelector('.game');
          game.classList.add("mobile");
          var notice = document.querySelectorAll('.notice');
          notice[0].style.display = 'none';
          notice[1].style.display = 'none';
      }else{
          var buttons = document.querySelector(".buttons");
          buttons.style.display = "none";
      }
      
      var game_control = true;
      
      function control(){
          var pp = document.querySelector(".pp");
          if (pp.classList.contains('active')){
              // play
              game_control = true;
          }else{
              // pause
              game_control = false;
          }
          pp.classList.toggle("active");
      }
      
      var player = document.querySelector('.player');
      var position = {x:30,y:60};
      
      var circle_opa = true;
      
      function jump(){
          if (game_control){
              
              if (jump_bool){
               circle_opa = false;
               $('.circle').css("opacity","1");
               game_control = false;
               camera_up();
//             $("body").get(0).style.setProperty("--sx", position.x);
             audio_jump.play();
             $("body").get(0).style.setProperty("--sy", 71);
             $("body").get(0).style.setProperty("--sr", 180);
          
             $('.player').animate({
                 bottom : '+=70px'
             },600,function(){
                 $("body").get(0).style.setProperty("--sy",0);
                 $("body").get(0).style.setProperty("--sr", 360);
             });
          
             $('.player').animate({
              bottom : '-=70px'
             },600,function(){
                 audio_jump.pause();
                 game_control = true;
                 circle_opa = true;
             });
                  
            }else{
                if (movement == 1 && jumping_bool){
                    console.log("run to jump front");
                    rjf();
                }else if (movement == -1 && jumping_bool){
                    console.log("run to jump back");
                    rjb();
                }
            }
          }
      }
      
      var camera_x = 0;
      var camera_y = 0;
      
      var movement = 0;
      
      function camera_up(){
              camera_y += 30;
              $("body").get(0).style.setProperty("--y", camera_y);
              setTimeout(function(){
                  camera_y -= 30;
                  $("body").get(0).style.setProperty("--y", camera_y);
              },500);
      }
      
      function bt_jump(){
          if (game_control && jump_bool){
              jump();
          }
      }
      
      var bool_right = false;
      var bool_left = false;
      var jump_bool = true;
      var jumping_bool = true;
      
      var render = setInterval(function(){
          check();
          if (bool_left){
              
              $('.circle').css("right","15px");
              if (position.x - 2 >= maps[position_check][0]){
                  position.x -= 2;
              }else{
                  position.x = maps[position_check][0];
              }
              $(".square").css("left",position.x + "px");
              jump_bool = false;
              movement = -1;
              d1 -= 0.05;
              
          }else if (bool_right){
              var next_x = maps[position_check+1][1];
              var next_y = maps[position_check+1][2];
              var pre_y = maps[position_check][2];
              $('.circle').css("right","5px");
              position.x += 2;
              $(".square").css("left",position.x + "px");
              jump_bool = false;
              movement = 1;
              d1 += 0.05;
              if (distance < d1){
                  distance = d1;
                  document.querySelector(".meters").innerHTML = distance.toFixed(1);
              }
          }
      },1000/70);
      
      window.addEventListener('keydown',(e) => {
          
//          left arrow	37
//          up arrow	38
//          right arrow	39
//          space 	    32
          if (e.keyCode == 38){
              if (game_control){
                  jump();
              }
          }
          if (e.keyCode == 32){
              control();
          }
          if (game_control){
              if (e.keyCode == 37){
                  bool_left = true;
              }else if (e.keyCode == 39){
                  bool_right = true;
              }
          }else{
              if (e.keyCode == 37 && jumping_bool){
                  console.log('jump to back');
                  jump_bool = false;
                  jb();
              }else if (e.keyCode == 39 && jumping_bool){
                  console.log('jump to front');
                  jump_bool = false;
                  jf();
              }
          }
          
      });
      
      function jf(){
          if (jumping_bool){
              game_control = false;
              jumping_bool = false;
              circle_opa = false;
              $('.pieces').css("opacity","0");
              $('.circle').css("right","5px");
              $('.square').css("transition","0.5s");
              $('.square').css("left","+=45px");
              position.x += 45;
              d1 += ((45 * 0.05) / 2);
              if (distance < d1){
                  distance = d1;
                  document.querySelector(".meters").innerHTML = distance.toFixed(1);
              }
              setTimeout(function(){
                  $('.square').css("transition","0s");
                  $('.pieces').css("opacity","1");
                  game_control = true;
                  jumping_bool = true;
                  circle_opa = true;
              },800);
          }
      }
      
      function jb(){
          if (jumping_bool){
              jumping_bool = false;
              game_control = false;
              circle_opa = false;
              $('.pieces').css("opacity","0");
              $('.circle').css("right","15px");
              $('.square').css("transition","0.5s");
              if (position.x - 45 >= 0){
                  $('.square').css("left","-=45px");
                  position.x -= 45;
                  d1 -= ((45 * 0.05) / 2);
                  setTimeout(function(){
                      $('.square').css("transition","0s");
                      $('.pieces').css("opacity","1");
                      game_control = true;
                      jumping_bool = true;
                  },800);
              }else {
                  $('.square').css("left","0");
                  position.x = 0;
                  d1 = 0;
                  setTimeout(function(){
                      $('.square').css("transition","0s");
                      $('.pieces').css("opacity","1");
                      game_control = true;
                      jumping_bool = true;
                      circle_opa = true;
                  },800);
              }
          }
      }
      
      function rjf(){
          
      }
      
      function rjb(){
          
      }
      
//      gravity 
      
      const maps = [[0,121,60]];
      var position_check = 0;
      
      function check(){
          if (position.x + 5 >= maps[position_check][0] && position.x +5 <= maps[position_check][1]){
              // square is in position_check region
              camera_x = -1 * maps[position_check][0];
              $("body").get(0).style.setProperty("--x", camera_x);
              if (position.x == maps[position_check][0] && circle_opa){
                  $('.circle').css("opacity","0");
              }else{
                  $('.circle').css("opacity","1");
              }
              if (position.y != maps[position_check][2]){
                  game_control = false;
                  $('.square').css('transition',"0.3s");
                  $('.square').css('bottom',maps[position_check][2]);
                  position.y = maps[position_check][2];
                  setTimeout(function(){
                      $('.square').css('transition',"0s");
                      game_control = true;
                  },300);
              }
              if (position_check + 4 > maps.length){
                  generate();
              }
          }else if (position.x + 5 < maps[position_check][0]){
              // square is in previous region maps[position_check - 1]
              position_check -= 1;
              check();
          }else if (position.x + 5 > maps[position_check][1]){
              // square is in previous region maps[position_check + 1]
              if (position_check + 1 < maps.length){
                  position_check += 1;
                  check();
              }
          }
      }
      
      function generate(){
          var last_piece_s = maps[maps.length - 1][0];
          var last_piece_e = maps[maps.length - 1][1];
          var ww = Math.floor(Math.random()*180 + 60);
          var last_piece_h = maps[maps.length - 1][2];
          var poss = [];
          if (last_piece_h == 0){
              poss = [30,60];
          }else if (last_piece_h == 30){
              poss = [0,60];
          }else if (last_piece_h == 60){
              poss = [0,30,90];
          }else if (last_piece_h == 90){
              poss = [30,60];
          }
          var hh = Math.floor(Math.random()*poss.length);
          var new1 = [last_piece_e,last_piece_e+ww,poss[hh]];
          var levels = document.querySelector(".levels");
          levels.innerHTML += '<div class="block" style="left:'+new1[0]+'px;height:'+new1[2]+'px;width:'+ww+'px;"></div>';
          maps.push(new1);
      }
      
      for (var i = 0;i<5;i++){
          generate();
      }
      
      window.addEventListener('keyup',(e) => {
//          console.log(e.keyCode);
          bool_right = false;
          bool_left = false;
          jump_bool = true;
      });
      
  </script>
  
</body>
</html>




<!--

<a href="https://www.hitwebcounter.com" target="_blank" class="c">
<img src="https://hitwebcounter.com/counter/counter.php?page=7711238&style=0001&nbdigits=6&type=ip&initCount=0" title="Total Website Hits" Alt="Web Hits"   border="0" /></a>

22,001


-->
