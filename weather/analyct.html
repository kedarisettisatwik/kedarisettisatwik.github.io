<html>
<head>
   <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.1/css/all.css">
    <link rel="icon" type="image" href="logo.png">
    
    <title>weather</title>
    
    <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
            font-family:poppins,monospace;
        }
        .flex{
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }
        body{
            width:100vw;
            min-height:100vh;
            display: flex;
            align-items: center;
            flex-direction: column;
            overflow-x: hidden;
            position:relative;
            background-color:whitesmoke;
            padding:20px 0;
        }
        .page{
            width:700px;
            min-height:400px;
            box-shadow:0 0 30px rgb(0,0,0,0.1);
            padding:20px;
            position:relative;
            background-color: white;
        }
        .page .logo{
            position:absolute;
            top:0;
            right:0;
            padding:20px;
            box-sizing: content-box;
            z-index:100;
            background-color: white;
            width:50px;
            height:50px;
        }
        .page header h1{
            font-size:24px;
            letter-spacing:1px;
        }
        .page header p{
            font-size:11px;
            letter-spacing:1px;
            margin-top:5px;
        }
        .page .search{
            margin-top:10px;
            justify-content: space-between;
        }
        .page .search .form,.page .search button{
            margin:20px 10px;
        }
        .page .search .form{
            flex-direction: column;
            align-items: flex-start;
            position:relative;
        }
        .page .search .form label{
            font-size:13px;
            color:blueviolet;
            font-weight:bold;
            letter-spacing:1px;
        }
        .page .search .form input[type="search"]{
            padding:0 15px;
            line-height:50px;
            height:50px;
            outline:none;
            border:none;
            background:none;
            margin:20px 0;
            box-shadow:0 0 8px rgb(0,0,0,0.15);
            font-size:14px;
        }
        .page .search .form input[type="submit"],.page .search button{
            padding:10px;
            font-size:12px;
            cursor:pointer;
            outline:none;
            border:none;
            background-color:blueviolet;
            color:white;
            font-weight:bold;
            letter-spacing:2px;
        }
        .page .line{
            margin:5px;
            height:2px;
            background-color:blueviolet;
        }
        .page .report{
            margin:20px 0;
        }
        .page .report .name{
            margin-bottom:20px;
        }
        .page .report .name label{
            font-size:25px;
            font-weight:bold;
            color:blueviolet;
            letter-spacing:1px;
            text-transform:capitalize;
        }
        .page .report .name span{
            font-size:14px;
        }
        .page .report .name p{
            font-size:12px;
            opacity:0.7;
        }
        .page .report h4{
            font-size:14px;
            font-weight:bold;
            letter-spacing:1px;
        }
        .page .report .today{
            flex-direction: row;
            justify-content: space-between;
            margin:10px 0;
            position:relative;
        }
        .page .report .today .main{
            margin:10px;
            padding:10px;
            flex-direction: column;
        }
        .page .report .today .main .temp{
            position:relative;
            padding:10px;
            padding-bottom:0px;
        }
        .page .report .today .main .temp h3{
            font-size:50px;
            color:blueviolet;
        }
        .page .report .today .main .temp label,.page .report .today .main .temp span{
            position: absolute;
            top:0;
            right:0;
            font-size:16px;
            font-weight:bold;
        }
        .page .report .today .main .temp span{
            top:6px;
            right:-12px;
            font-size:22px;
        }
        .page .report .today .main .description{
            font-size:22px;
            letter-spacing:1px;
            font-family: 'Dancing Script', monospace;
            text-transform:capitalize;
            color:blueviolet;
        }
        .page .report .today .other{
            margin:10px;
            padding:10px;
            flex-direction: row;
            flex-wrap: wrap;
            width:300px;
        }
        .page .report .today .other li{
            list-style:none;
            margin:5px;
            padding:5px;
        }
        .page .report .today .other li span,.page .report .today .other li label{
            display:block;
            width:120px;
        }
        .page .report .today .other li span{
            margin:5px 0;
            font-size:13px;
            letter-spacing:1px;
            font-weight:bold;
            opacity:0.8;
        }
        .page .report .today .other .time{
            width:100%;
            height:50px;
            position:relative;
            margin-bottom:10px;
        }
        .page .report .today .other .time .line{
            width:100%;
            height:2px;
            background-color: grey;
        }
        .page .report .today .other .time span{
            position: absolute;
            font-size:11px;
        }
        .page .report .today .other .time span:nth-child(2){
            bottom:-5px;
            left:0;
        }
        .page .report .today .other .time span:nth-child(3){
            bottom:-5px;
            right:0;
        }
        .page .report .today .other .time span:nth-child(5){
            top:0;
            left:0;
        }
        .page .report .today .other .time .sun{
            position:absolute;
            width:15px;
            height:15px;
            top:50%;
            left:50%;
            transform:translate(-50%,-50%);
            background-color: orangered;
            box-shadow:0 0 8px rgb(0,0,0,0.1);
            border-radius:50%;
        }
        
        .page .report .today .other li label i{
            font-style:normal;
        }
        .page .report .today .other li label{
            font-size:14px;
        }
        .page .report .today .other li label sup{
            font-size:10px;
        }
        .page .report .next .table{
            width:100%;
            margin:20px 0;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        .page .report .next .table li{
            list-style:none;
            display: block;
            margin:15px 10px;
            width:300px;
        }
        .page .report .next .table li p{
            font-size:15px;
            font-weight:bold;
            letter-spacing:1px;
            margin:10px 0;
        }
        .page .report .next .table li span{
            display: block;
            font-size:14px;
        }
        
        @media (max-width:720px){
            body{
                padding:0;
                background-color: white;
            }
            .page{
                width:100%;
                box-shadow:0 0 30px rgb(0,0,0,0);
            }
        }
        @media (max-width:600px){
            .page header p{
                width: calc(100% - 100px);
            }
            .page .search{
                align-items:flex-start;
                flex-direction: column;
            }
            .page .search button{
                margin:0 10px;
            }
            .page .report .today{
                flex-direction: column;
            }
        }
    </style>
    
    </head>
<body>
   
       <section class="page"> 
           <header>
               <h1>Weather Analyct</h1>
               <p>Find out the how the weather will be in following days ...</p>
           </header>
           <div class="search flex">
               <form class="form flex" id="form" autocomplete="off">
                  <label>Enter City Name:</label>
                   <input type="search" id='city' placeholder="Example Delhi" required>
                   <input type="submit" value="FIND">
               </form>
               <button onclick="findLoc()">
                   Get Device Location
               </button>
           </div>
           <div class="line"></div>
           <img src="logo.png" class="logo">
           <section class="report">
               <div class="name">
                   <label id="city_name">Delhi,</label>
                   <span id="country_name">INDIA</span>
                   <p id="cords">16.458 N | -83.123 E </p>
               </div>
               <h4>Today <span id="dat">04 / 10</span></h4>
               <div class="today flex">
                   <div class="main flex">
                       <div class="temp">
                           <h3 id="today_temp">26</h3>
                           <label>o</label>
                           <span>c</span>
                       </div>
                       <div class="description" id="condition">
                           Clear Sky
                       </div>
                   </div>
                   
                   <div class="other flex">
                      <div class="time flex">
                          <div class="line"></div>
                          <span>Sunrise <label id="rise_time">06 : 20</label> </span>
                          <span>Sunset <label id="set_time">18 : 31</label> </span>
                          <div class="sun" id="sun"></div>
                          <span>Now <label id="pre_time">11 : 00</label></span>
                      </div>
                       <li>
                           <span>Real Feel</span>
                           <label><i id="real_temp">26</i> <sup>C</sup></label>
                       </li>
                       <li>
                           <span>Humidity</span>
                           <label id="humidity">74%</label>
                       </li>
                       <li>
                           <span>Pressure</span>
                           <label id="pressure">1006 mbar</label>
                       </li>
                       <li>
                           <span>Wind Speed</span>
                           <label id="wind">5.3 km/hr</label>
                       </li>
                   </div>
               </div>
               <div class="next">
                   <h4>Days ForeCast</h4>
                   <div class="table flex" id="table">
                       
                   </div>
               </div>
           </section>
       </section>
   
    <script>
        
        key = 'a1aa491c2cb2113ad316ee318d0bf647'
        form = document.getElementById('form');
        form.addEventListener('submit',(e) => {
            e.preventDefault();
            getLocation();
        })
        
        defaultWeather();
        
        function findLoc(){
            if (navigator.geolocation){
                navigator.geolocation.getCurrentPosition(Got,Lost);
            }else{
                alert('browser not supporting geoloaction');
            }
        }
        
        function Got(position){
            console.log(position);
            getWeather(position.coords.latitude,position.coords.longitude,"*","*");
        }
        
        function Lost(error){
            console.log('error');
        }
        
        function defaultWeather(){
            document.getElementById('city').value = 'delhi';
            getLocation();
        }
        
        function cityTime(pp,tt){
            var utc = pp + new Date().getTimezoneOffset()*60000;
            var timeCity = new Date( utc + (tt*1000) );
            return timeCity;
        }
        
        function displayWeather(lat,lon,name,country,sunrise,sunset,list,tt){
            console.log(list);
            var ct = cityTime(new Date().getTime(),tt);
            document.getElementById('city_name').innerHTML = name;
            document.getElementById('country_name').innerHTML = country;
            document.getElementById('cords').innerHTML = lat.toFixed(3) + ' N | ' + lon.toFixed(3) + ' E';
            document.getElementById('dat').innerHTML = ' : ' + ct.toLocaleDateString();
            
            var rt = cityTime(sunrise*1000,tt);
            var st = cityTime(sunset*1000,tt);
            document.getElementById('rise_time').innerHTML = rt.getHours() + ' : ' + rt.getMinutes();
            document.getElementById('set_time').innerHTML = st.getHours() + ' : ' + st.getMinutes();
            document.getElementById('pre_time').innerHTML = ct.getHours() + ' : ' + ct.getMinutes();
            
            var sun = document.getElementById('sun');
//            console.log(r,p,s);
            var x = rt.getHours()*60 + rt.getMinutes();
            var y = ct.getHours()*60 + ct.getMinutes();
            var z = st.getHours()*60 + st.getMinutes();
            if (y > x && y < z){
                sun.style.left = ((y-x)/(z-x))*100 + '%';
            }else if (y <= x){
                sun.style.left = '0%';
            }else if (y >= z){
                sun.style.left = '100%';
            }
            document.getElementById('today_temp').innerHTML = list[0].main.temp.toFixed(2);
            document.getElementById('condition').innerHTML = list[0].weather[0].description;
            document.getElementById('real_temp').innerHTML = list[0].main.feels_like.toFixed(2);
            document.getElementById('humidity').innerHTML = list[0].main.humidity.toFixed(1) + ' % ';
            document.getElementById('pressure').innerHTML = list[0].main.pressure.toFixed(0) + ' mbar ';
            document.getElementById('wind').innerHTML = (list[0].wind.speed * (18/5)).toFixed(2) + ' kmph';
            var table = document.getElementById('table');
            table.innerHTML = '';
            for (var i = 1;i<list.length;i++){
                var d = new Date(list[i].dt_txt).getDate();
                table.innerHTML += '<li> <p> '+d+' / 10 </p> <span>Temp : <label>'+list[i].main.feels_like.toFixed(2)+'</label></span> <span>Humidity : <label>'+list[i].main.humidity.toFixed(1) + ' % '+'</label></span> <span><label>'+list[i].weather[0].description+'</label></span> <span>Wind : <label>'+ (list[i].wind.speed * (18/5)).toFixed(2) + ' kmph' +'</label></span> <span>Pressure : <label>'+list[i].main.pressure.toFixed(0) + ' mbar '+'</label></span> </li>';
            }
        }
        
        function getWeather(lat,lon,name,country){
            api = 'https://api.openweathermap.org/data/2.5/forecast?lat='+lat+'&units=metric&lon='+lon+'&appid='+key;
            fetch(api).then(function(response){
                var data = response.json();
                return data;
            }).then(function(data){
                if (data.length == 0){
                    alert('Invalid location');
                }else{
                    list = data.list;
                    days = [];
                    var tt = data.city.timezone;
                    var dd = []
                    for (var i = 0;i<list.length;i++){
                        var d = new Date(list[i].dt_txt).getDate();
                        if (dd.includes(d)){
                            continue;
                        }else{
                            days.push(list[i]);
                            dd.push(d);
                        }
                    }
//                    console.log(data);
                    if (name == '*'){
                        name = data.city.name;
                        country = data.city.country;
                        document.getElementById('city').value = data.city.name;
                    }
                    displayWeather(lat,lon,name,country,data.city.sunrise,data.city.sunset,days,tt);
                }
            })
        }
        
        function getLocation(){
            city = document.getElementById('city').value;
            api = 'https://api.openweathermap.org/geo/1.0/direct?q='+city+'&limit=1&appid='+key
            fetch(api).then(function(response){
                var data = response.json();
                return data;
            }).then(function(data){
                if (data.length == 0){
                    alert('Invalid City Name');
                }else{
                    name = data[0].name;
                    country = data[0].country;
                    lat = data[0].lat;
                    lon=data[0].lon;
//                    console.log(data);
                    getWeather(lat,lon,name,country);
                }
            })
        }
        
    </script>
    
    </body>
</html>

<!-- 

weather data sunrise = * 1000

time = new Date(weather data sunrise)

-->
