<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap" rel="stylesheet">
    <!-- google fonts -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
    
    <title>network</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            list-style:none;
            text-decoration:none;
        }
        html {
            scroll-behavior: smooth;
        }
        ::-webkit-scrollbar{
            width:5px;
        }
        ::-webkit-scrollbar-thumb{
            background-color:black;
        }
        .flex{
            display:flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .bg{
            background-position: center;
            background-repeat: no-repeat;
            background-size:cover;
        }
        body{
            width:100vw;
            height:90vh;
            background-color:lavenderblush;
            overflow: hidden;
        }
        /* chat page */
        
        
        #chat_place{
            background-image:url(wall/im5.png);
            height:90vh;
            width:100vw;
            overflow-y: auto;
            overflow-x: hidden;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }
        .header{
            position:absolute;
            top:10px;
            width:95%;
            border-radius:15px;
            left:50%;
            transform:translateX(-50%);
            overflow: hidden;
            font-size:16px;
            display:flex;
            justify-content:space-between;
            align-items: center;
            flex-direction: row;
            box-shadow:0 0 10px rgb(0,0,0,0.2);
            background-color: white;
            padding:8px;
        }
        .header img{
            width:40px;
            margin:0 10px;
            object-fit: cover;
            border-radius:8px;
            height:40px;
            box-shadow: 0 0 5px rgb(0,0,0,0.3);
        }
        .header span{
            max-width:200px;
            overflow-x: hidden;
            margin:0 10px;
        }
        .header i{
            margin:0 10px;
            width:40px;
            height:40px;
            line-height:40px;
            text-align:center;
            font-size:22px;
            cursor:pointer;
            transition:0.3s;
        }
        .header i.fa-bars.active{
            transform:rotateZ(90deg);
        }
        .input{
        z-index:2;
         position: absolute;
         bottom:30px;
         left:0;
         width:100%;
         height:60px;
         display: flex;
         justify-content: center;
         align-items: center;
         flex-direction: row;
        }
        .input textarea{
            width:calc(100% - 50px);
            height:45px;
            outline:none;
            border:none;
            border-radius:15px;
            background-color:white;
            font-size:15px;
            resize:none;
            overflow-x: hidden;
            overflow-y: auto;
            padding:10px 0 10px 20px;
            margin-left:10px;
            box-shadow:0 0 5px rgb(0,0,0,0.4);
            transition:0.3s;
        }
        .input textarea:focus{
            transform:translateY(-25px);
        }
        .input textarea:focus ~ i{
            transform:translateY(-25px);
        }
        .input textarea::placeholder{
            color:black;
        }
        .input i{
            transition:0.3s;
            width:40px;
            height:40px;
            line-height:40px;
            font-size:18px;
            text-align:center;
            cursor:pointer;
            background-color: white;
            border-radius:50%;
            padding:5px;
            margin:0 10px;
           box-shadow:0 0 5px rgb(0,0,0,0.4);
        }
        #options{
            z-index:4;
            top:20px;
            left:20px;
            transform:scale(0);
            transition:0.3s;
            transform-origin:top left;
           position:absolute;
           width:200px;
            padding:10px;
            background-color: white;
            font-size:17px;
            box-shadow:0 0 10px rgb(0,0,0,0.4);
        }
        #options.active{
            transform:scale(1);
        }
        #options li{
            margin:14px 0;
            width:100%;
            padding:5px;
            cursor:pointer;
            text-align: center;
        }
        #add_msg{
            z-index:0;
           position: absolute;
            top:0;
            left:0;
            width:100%;
            height:calc(100% - 100px);
            overflow-x: hidden;
            overflow-y: auto;
            background-color: transparent;
            padding-bottom:100px;
            padding-top:50px;
            transform:rotateZ(180deg);
        }
        .sample{
             -webkit-animation: memsg 0.6s linear forwards;
            transform:rotateZ(180deg);
            margin-bottom:5px;
            width:100%;
        }
        .sample.me{
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-direction: row;
        }
        @keyframes memsg{
            0%{transform:rotateZ(180deg) translateY(15px);}
            100%{transform:rotateZ(180deg) translateY(0px);}
        }
        .sample.other{
            display: flex;
            justify-content: flex-start;
            align-items: center;
            flex-direction: row;
        }
        .sample div{
            position:relative;
            padding:10px;
            font-size:16px;
            border-radius:5px;
            max-width:70%;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            flex-direction: column;
        }
        .sample span{
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .sample .time{
            position: relative;
            margin-top:5px;
            padding:5px;
            font-size:11px;
        }
        .sample.me .time{
            background-color:cornflowerblue; /* here a variable bgme */
            color:white; /* here a variable colorme */
        }
        .sample.other .time{
            background-color:white; /* here a variable bgother */
            color:black; /* here a variable colorother */
        }
        .sample.me div{
            background-color:cornflowerblue; /* here a variable bgme */
            color:white; /* here a variable colorme */
            margin-right:10px;
        }
        .sample.me div::after{
            content:'';
            position:absolute;
            width:12px;
            height:12px;
            top:50%;
            right:0;
            background-color:cornflowerblue; /* here a variable bgme*/
            transform:translate(50%,-50%) rotateZ(45deg);
        }
        .sample.other div{
            background-color:white; /* here a variable bgother */
            color:black;    /* here a variable colorother */
            margin-left:10px;
        }
        .sample.other div::after{
            content:'';
            position:absolute;
            width:12px;
            height:12px;
            top:50%;
            left:0;
            background-color:white; /* here a variable bgoother */
            transform:translate(-50%,-50%) rotateZ(45deg);
        }
/* chat page */
    </style>
</head>

<body class="flex">
    
    <section class="flex pop_page" id="chat_place">

    <div id="add_msg">

    </div>
    
    <div class="header">
    <i class="fas fa-long-arrow-alt-left" onclick="close1()"></i>
    <img src="" id="chat_dp"><span id="chat_name"></span>
    <i class="fas fa-bars" onclick="show_options()"></i>
    </div>
    
    <ul id="options">
        <li onclick="delete_chat()">Delete chat</li>
        <li onclick="open_with()">see profile</li>
    </ul>
    
    <div class="input">
        <textarea id="msg_content" placeholder="enter message"></textarea>
     <i class="fa fa-paper-plane flex" aria-hidden="true" onclick="send_msg1()"></i>
    </div>
    
    </section>
    

<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase.js"></script>

<script>
  var firebaseConfig = {
    apiKey: "AIzaSyARQ2BkDwc8ET4ElFTx4tv3huFGTXs75xY",
    authDomain: "network-c2f65.firebaseapp.com",
    projectId: "network-c2f65",
    storageBucket: "network-c2f65.appspot.com",
    messagingSenderId: "565713313358",
    appId: "1:565713313358:web:3935560cb111b6b83f6d1f"
  };
  firebase.initializeApp(firebaseConfig);
    
    const auth = firebase.auth();
    const base = firebase.database();
    
</script>
    
    <script>
        var st = false;
        const myurl = new URL(window.location.href);
        let user_key = myurl.searchParams.get("user_name");
        let other_key = myurl.searchParams.get("other");
        
        
        function open_with(){
             var li4 = "profile.html?user_name="+other_key+"&other="+user_key;
             location.href = li4;
        }
        
        var followers = [];
        
        firebase.database().ref('users/'+user_key+"/follow").once('value',function(snapshot){
             snapshot.forEach(function(ChildSnapShot){
                 var name1 = ChildSnapShot.val().name;
                 followers.push(name1); 
                 st = true;
             })
        });
        
       function show_options(){
           var  fa_bars = document.querySelector(".fa-bars"); 
           var options = document.querySelector("#options");
            fa_bars.classList.toggle("active");
            options.classList.toggle("active");
        }
        
        function draw1(){
            var chat_dp = document.getElementById("chat_dp");
            var chat_name = document.getElementById("chat_name");
            
            firebase.database().ref('users/'+other_key).once('value',function(snapshot){
                var user_name = snapshot.val().name;
                var user_dp1 = snapshot.val().dp;
                
                chat_dp.src = user_dp1;
                chat_name.innerHTML = user_name;
            });
            
            var in_msg = document.getElementById("msg_content");
            in_msg.innerHTML = "";
            in_msg.select();
            
              var chat_area = document.getElementById("add_msg");
            
    firebase.database().ref('users/'+user_key+"/messages/"+other_key).on('value',function(snapshot){
          chat_area.innerHTML = "";
        snapshot.forEach(function(ChildSnapShot){
             var other_me = ChildSnapShot.val().sender_name;
             var content_msg = ChildSnapShot.val().send_msg;
             var time_msg = ChildSnapShot.val().send_time;
             if (other_me == user_key){
            chat_area.innerHTML = "<div class='sample me'><div><span>"+content_msg+"</span><label class='time'>"+time_msg+"</label>"+"</div></div>" + chat_area.innerHTML;
             }else{
        chat_area.innerHTML = "<div class='sample other'><div><span>"+content_msg+"</span><label class='time'>"+time_msg+"</label>"+"</div></div>" + chat_area.innerHTML;
             }
        })   
            });
            
        }
        
        draw1();
        
        function delete_chat(){
            firebase.database().ref('users/'+user_key+"/messages/"+other_key).remove(); 
            show_options();
        }
        
        function close1(){
         firebase.database().ref("users/"+other_key+"/unseen1/"+user_key).remove();
         firebase.database().ref("users/"+other_key+"/active/"+user_key).remove();
            window.history.go(-1);
        }
        
        function send_msg1(){
            
            if (st){
             
            var msg_content = document.getElementById("msg_content").value;
            var add_msg = document.getElementById("add_msg");
                
             document.getElementById("msg_content").value = "";
             
                    var date11 = new Date().getDate();
                    var month11 = new Date().getMonth();
                    var year11 = new Date().getFullYear();
                    var hour1 = new Date().getHours();
                    var minute1 = new Date().getMinutes();
                    
        var mo_li1 = ["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dec"];
     var dd11 = date11 + " " + mo_li1[month11] + " " + year11 + " | "+hour1 + " : " +minute1;
             
            if (msg_content.length > 0){
                
                firebase.database().ref("users/"+other_key+"/unseen1/"+user_key).remove();
                
                if (followers.includes(other_key)){
                    
                }else{
                    
                firebase.database().ref("users/"+other_key+"/follow").push({
                           name : user_key,
                });
                    
                 firebase.database().ref("users/"+user_key+"/follow").push({
                           name : other_key,
                });
                    
                }
                
                var date_unseen = Date.now();
                
                firebase.database().ref("users/"+other_key+"/unseen1/"+user_key).push({
                           dateun : date_unseen
                }); 
                
                firebase.database().ref("users/"+user_key+"/active/"+other_key).update({
                           dateun : date_unseen
                });
                
        firebase.database().ref('users/'+ user_key+"/messages/"+other_key).push({
               sender_name : user_key,
               send_msg : msg_content,
               send_time : dd11  
            });
                
     firebase.database().ref('users/'+other_key+"/messages/"+user_key).push({
               sender_name : user_key,
               send_msg : msg_content,
               send_time : dd11
               });
                
            }
    
            }
        }
        
        
        window.addEventListener("contextmenu", (e) => {
              e.preventDefault();
        })
        
    </script>
    
</body>
</html>
